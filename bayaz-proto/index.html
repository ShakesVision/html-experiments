<!DOCTYPE html>
<html lang="ur" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayaaz - Notion Style Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Noto+Nastaliq+Urdu&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/shakeeb-justify@1.0.0/dist/shakeeb-justify.min.css" rel="stylesheet">
    <style>
        /* Define custom font classes */
        .nastaleeq-font {
            font-family: 'Noto Nastaliq Urdu', serif;
        }

        .amiri-font {
            font-family: 'Amiri Quran', serif;
        }

        /* Custom styles for the editor and buttons */
        #editor-container {
            min-height: 80vh;
            outline: none;
        }

        .block-options-toolbar {
            /* Position the toolbar above the keyboard on mobile */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 20;
            background-color: white;
            padding: 0.5rem;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Style for the plus button */
        .add-block-btn {
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-right: 8px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out;
        }

        p:hover .add-block-btn,
        h1:hover .add-block-btn,
        h2:hover .add-block-btn {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col min-h-screen nastaleeq-font">

    <header class="bg-white p-4 shadow-md flex justify-between items-center z-10">
        <h1 class="text-xl font-bold">بیاض</h1>
        <button id="save-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-all">محفوظ
            کریں</button>
    </header>

    <main class="flex-grow p-4 overflow-y-auto">
        <div id="editor-container" contenteditable="true"
            class="bg-white p-6 rounded-lg shadow-lg max-w-2xl mx-auto space-y-4 text-xl">
            <p data-block-id="1" class="relative">یہاں کچھ لکھنا شروع کریں...</p>
        </div>
    </main>

    <div id="toolbar" class="block-options-toolbar hidden flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <button id="font-btn" class="p-2 rounded-md hover:bg-gray-200" title="Change Font">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 4v1m6.364 1.636l-.707.707M21 12h-1m-1.636 6.364l-.707-.707M12 20v-1m-6.364-1.636l.707-.707M4 12H3m1.636-6.364l.707-.707M12 10.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm4.5 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm-7.5 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" />
                </svg>
            </button>
            <button id="justify-btn" class="p-2 rounded-md hover:bg-gray-200" title="Justify Text">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </div>
        <button id="plus-btn"
            class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-all text-2xl font-bold leading-none">
            +
        </button>
    </div>

    <div id="block-menu" class="hidden absolute z-30 p-4 bg-white rounded-lg shadow-lg">
        <ul class="space-y-2">
            <li><button class="block-type-btn p-2 rounded-md hover:bg-gray-100 w-full text-right"
                    data-type="p">پیراگراف</button></li>
            <li><button class="block-type-btn p-2 rounded-md hover:bg-gray-100 w-full text-right" data-type="h1">عنوان
                    1</button></li>
            <li><button class="block-type-btn p-2 rounded-md hover:bg-gray-100 w-full text-right" data-type="h2">عنوان
                    2</button></li>
            <li><button class="block-type-btn p-2 rounded-md hover:bg-gray-100 w-full text-right"
                    data-type="blockquote">اقتباس</button></li>
        </ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editor = document.getElementById('editor-container');
            const toolbar = document.getElementById('toolbar');
            const plusBtn = document.getElementById('plus-btn');
            const blockMenu = document.getElementById('block-menu');
            const blockTypeBtns = document.querySelectorAll('.block-type-btn');

            let currentBlock = null;
            let blockCounter = 1;

            // --- Core Block Management Functions ---

            function createBlock(tag = 'p', content = '', id = blockCounter++) {
                const newBlock = document.createElement(tag);
                newBlock.innerHTML = content || '<br>';
                newBlock.dataset.blockId = id;
                newBlock.className = 'relative';

                const plusIcon = document.createElement('span');
                plusIcon.className = 'add-block-btn';
                plusIcon.innerHTML = `<button class="p-1 rounded-full bg-blue-500 text-white text-lg leading-none" title="Add Block">+</button>`;
                newBlock.appendChild(plusIcon);

                newBlock.addEventListener('click', () => {
                    currentBlock = newBlock;
                });
                return newBlock;
            }

            function insertNewBlock(refBlock, content = '', type = 'p') {
                const newBlock = createBlock(type, content);
                if (refBlock && refBlock.nextSibling) {
                    refBlock.parentNode.insertBefore(newBlock, refBlock.nextSibling);
                } else {
                    editor.appendChild(newBlock);
                }
                newBlock.focus();
                const selection = window.getSelection();
                const range = document.createRange();
                range.setStart(newBlock, 0);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);

                hideBlockMenu();
            }

            // --- UI and Event Handlers ---

            // Show/hide toolbar on focus
            editor.addEventListener('focusin', () => toolbar.classList.remove('hidden'));
            editor.addEventListener('focusout', (e) => {
                if (!e.relatedTarget || !toolbar.contains(e.relatedTarget)) {
                    toolbar.classList.add('hidden');
                }
            });

            plusBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                blockMenu.classList.toggle('hidden');
                const rect = plusBtn.getBoundingClientRect();
                blockMenu.style.bottom = `${window.innerHeight - rect.top + 10}px`;
                blockMenu.style.left = `${rect.left}px`;
            });

            document.addEventListener('click', (e) => {
                if (!blockMenu.contains(e.target) && !plusBtn.contains(e.target)) {
                    hideBlockMenu();
                }
            });

            function hideBlockMenu() {
                blockMenu.classList.add('hidden');
            }

            // Markdown conversion on keypress
            editor.addEventListener('input', (e) => {
                if (e.inputType === 'insertText' && e.data === ' ') {
                    const block = window.getSelection().anchorNode.parentNode;
                    const text = block.textContent.trim();
                    let newTag = null;

                    if (text === '#') newTag = 'h1';
                    else if (text === '##') newTag = 'h2';
                    else if (text === '>') newTag = 'blockquote';

                    if (newTag) {
                        const newElement = document.createElement(newTag);
                        newElement.innerHTML = '<br>';
                        newElement.className = block.className;
                        block.replaceWith(newElement);

                        const selection = window.getSelection();
                        const range = document.createRange();
                        range.selectNodeContents(newElement);
                        range.collapse(false);
                        selection.removeAllRanges();
                        selection.addRange(range);
                    }
                }
            });

            // Enter key to create a new paragraph block
            editor.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const selection = window.getSelection();
                    const range = selection.getRangeAt(0);

                    // Corrected way to find the parent element
                    const block = range.startContainer.nodeType === 3
                        ? range.startContainer.parentNode
                        : range.startContainer;

                    if (block.closest('[data-block-id]')) {
                        insertNewBlock(block.closest('[data-block-id]'));
                    }
                }
            });

            // Handle block type changes from the menu
            blockTypeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const type = btn.dataset.type;
                    const selection = window.getSelection();
                    const block = selection.anchorNode.parentNode;

                    if (block) {
                        const newElement = document.createElement(type);
                        newElement.innerHTML = block.innerHTML;
                        newElement.className = block.className;
                        block.replaceWith(newElement);
                    }
                    hideBlockMenu();
                });
            });

            // Global style controls in the toolbar
            document.getElementById('font-btn').addEventListener('click', () => {
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const block = selection.anchorNode.parentNode;
                    block.classList.toggle('amiri-font');
                    block.classList.toggle('nastaleeq-font');
                }
            });

            document.getElementById('justify-btn').addEventListener('click', () => {
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const block = selection.anchorNode.parentNode;
                    block.classList.toggle('justify-text');
                }
            });

            // Initial block setup
            const initialBlock = document.querySelector('[data-block-id]');
            initialBlock.addEventListener('click', () => {
                currentBlock = initialBlock;
            });
        });
    </script>

</body>

</html>